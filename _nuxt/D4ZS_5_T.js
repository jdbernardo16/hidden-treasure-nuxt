import{d as ae,X as ne,K as le,N as re,W as de,E as p,D as c,Y as ie,p as ce,ad as ue,n as me,o as l,c as d,b as s,h as b,F as f,a as m,w as A,e,t as o,i,r as _e,_ as pe,g as fe,k as he}from"./BwNhNsUt.js";import{_ as ge,a as ye}from"./BQKFZ-NK.js";import{O as ve}from"./D7O7cBjx.js";const xe={class:"w-full min-h-[600px] flex items-center p-4 text-gray-800 md:bg-white md:rounded-xl md:mx-auto md:shadow-lg md:my-24 md:mt-8 md:max-w-3xl md:p-16 flex-col"},be={key:0,class:"w-full"},we={key:0,class:"flex items-center gap-4"},ke={class:"text-xl font-semibold"},Ie={class:"flex items-center justify-between w-full mb-2"},$e={class:"text-xl font-semibold"},Te={key:1,class:"flex-1 w-full"},je={class:"flex items-start justify-between"},Ce={class:"w-[21%]"},De={class:"mb-2 text-xs text-gray-400 uppercase"},Le={class:"leading-none"},Me={class:"w-[21%]"},Be={class:"mb-2 text-xs text-gray-400 uppercase"},Ee={class:"leading-none"},Oe={class:"w-[21%]"},Pe={class:"mb-2 text-xs text-gray-400 uppercase"},Se={class:"w-[21%]"},Ne={class:"mb-2 text-xs text-gray-400 uppercase"},qe={class:"leading-none"},Re={class:"grid gap-2"},Fe=["src","alt","title"],Ge={class:"flex-1 leading-tight"},He={class:"text-sm text-gray-600"},Ve={class:"text-sm font-semibold"},ze={key:1},Ue={class:"flex justify-between"},Ae={class:"flex justify-between"},Ke={class:"flex justify-between"},Qe={key:0,class:"flex justify-between text-primary"},We={class:"flex justify-between"},Xe={class:""},Ye={class:"font-semibold"},Je={key:2,class:"flex flex-col items-center justify-center flex-1 w-full gap-4 text-center"},Ze=["innerHTML"],es=2500,ns=ae({__name:"order-summary",setup(ss){const{query:_,params:K,name:w}=ne(),{customer:Q}=le(),{formatDate:W,formatPrice:X}=re(),{t:k}=de(),n=p(null),Y=p(_.fetch_delay==="true"),h=p(!1),u=p(""),J=c(()=>{var t;return!((t=Q.value)!=null&&t.email)}),I=c(()=>w==="order-summary"),g=c(()=>w==="order-received"),y=c(()=>{var t;return((t=n.value)==null?void 0:t.status)!==ve.COMPLETED}),Z=c(()=>{var t;return!!parseFloat(((t=n.value)==null?void 0:t.rawDiscountTotal)||"0")}),$=c(()=>{var t,a;return((a=(t=n.value)==null?void 0:t.downloadableItems)==null?void 0:a.nodes)||[]});ie(()=>{g.value&&(_.cancel_order||_.from_paypal||_.PayerID)&&window.close()}),ce(async()=>{await v(),g.value&&Y.value&&y.value&&setTimeout(()=>{v()},es)});async function v(){var t;try{const a=await ue({id:K.orderId});a.order?n.value=a.order:u.value="Could not find order"}catch(a){u.value=((t=a==null?void 0:a.gqlErrors)==null?void 0:t[0].message)||"Could not find order"}h.value=!0}const ee=async()=>{h.value=!1,await v()};return me({title(){return I.value?k("messages.shop.orderSummary"):k("messages.shop.orderReceived")}}),(t,a)=>{const se=he,x=pe,T=fe,te=ge,oe=ye;return l(),d("div",xe,[s(h)?(l(),d(f,{key:1},[s(n)?(l(),d("div",be,[s(I)?(l(),d("div",we,[m(T,{to:"/my-account?tab=orders",class:"inline-flex items-center justify-center p-2 border rounded-md",title:"Back to orders","aria-label":"Back to orders"},{default:A(()=>[m(x,{name:"ion:chevron-back-outline"})]),_:1}),e("h1",ke,o(t.$t("messages.shop.orderSummary")),1)])):s(g)?(l(),d(f,{key:1},[e("div",Ie,[e("h1",$e,o(t.$t("messages.shop.orderReceived")),1),s(y)?(l(),d("button",{key:0,type:"button",class:"inline-flex items-center justify-center p-2 bg-white border rounded-md",title:"Refresh order","aria-label":"Refresh order",onClick:ee},[m(x,{name:"ion:refresh-outline"})])):i("",!0)]),e("p",null,o(t.$t("messages.shop.orderThanks")),1)],64)):i("",!0),a[0]||(a[0]=e("hr",{class:"my-8"},null,-1))])):i("",!0),s(n)&&!s(J)?(l(),d("div",Te,[e("div",je,[e("div",Ce,[e("div",De,o(t.$t("messages.shop.order")),1),e("div",Le,"#"+o(s(n).databaseId),1)]),e("div",Me,[e("div",Be,o(t.$t("messages.general.date")),1),e("div",Ee,o(s(W)(s(n).date)),1)]),e("div",Oe,[e("div",Pe,o(t.$t("messages.general.status")),1),s(n).status?(l(),b(te,{key:0,order:s(n)},null,8,["order"])):i("",!0)]),e("div",Se,[e("div",Ne,o(t.$t("messages.general.paymentMethod")),1),e("div",qe,o(s(n).paymentMethodTitle),1)])]),s(n).lineItems?(l(),d(f,{key:0},[a[1]||(a[1]=e("hr",{class:"my-8"},null,-1)),e("div",Re,[(l(!0),d(f,null,_e(s(n).lineItems.nodes,r=>{var j,C,D,L;return l(),d("div",{key:r.id,class:"flex items-center justify-between gap-8"},[(j=r.product)!=null&&j.node?(l(),b(T,{key:0,to:`/product/${r.product.node.slug}`},{default:A(()=>{var M,B,E,O,P,S,N,q,R,F,G,H,V,z,U;return[e("img",{class:"w-16 h-16 rounded-xl",format:"webp",quality:"90",src:((E=(B=(M=r.variation)==null?void 0:M.node)==null?void 0:B.image)==null?void 0:E.sourceUrl)||((P=(O=r.product.node)==null?void 0:O.image)==null?void 0:P.sourceUrl)||"/images/placeholder.png",alt:((q=(N=(S=r.variation)==null?void 0:S.node)==null?void 0:N.image)==null?void 0:q.altText)||((F=(R=r.product.node)==null?void 0:R.image)==null?void 0:F.altText)||"Product image",title:((V=(H=(G=r.variation)==null?void 0:G.node)==null?void 0:H.image)==null?void 0:V.title)||((U=(z=r.product.node)==null?void 0:z.image)==null?void 0:U.title)||"Product image",loading:"lazy"},null,8,Fe)]}),_:2},1032,["to"])):i("",!0),e("div",Ge,o(r.variation?(D=(C=r.variation)==null?void 0:C.node)==null?void 0:D.name:(L=r.product)==null?void 0:L.node.name),1),e("div",He,"Qty. "+o(r.quantity),1),e("span",Ve,o(s(X)(r.total)),1)])}),128))])],64)):i("",!0),a[4]||(a[4]=e("hr",{class:"my-8"},null,-1)),s($).length&&!s(y)?(l(),d("div",ze,[m(oe,{downloadableItems:s($)},null,8,["downloadableItems"]),a[2]||(a[2]=e("hr",{class:"my-8"},null,-1))])):i("",!0),e("div",null,[e("div",Ue,[e("span",null,o(t.$t("messages.shop.subtotal")),1),e("span",null,o(s(n).subtotal),1)]),e("div",Ae,[e("span",null,o(t.$t("messages.general.tax")),1),e("span",null,o(s(n).totalTax),1)]),e("div",Ke,[e("span",null,o(t.$t("messages.general.shipping")),1),e("span",null,o(s(n).shippingTotal),1)]),s(Z)?(l(),d("div",Qe,[e("span",null,o(t.$t("messages.shop.discount")),1),e("span",null,"- "+o(s(n).discountTotal),1)])):i("",!0),a[3]||(a[3]=e("hr",{class:"my-8"},null,-1)),e("div",We,[e("span",Xe,o(t.$t("messages.shop.total")),1),e("span",Ye,o(s(n).total),1)])])])):s(u)?(l(),d("div",Je,[m(x,{name:"ion:sad-outline",size:"96",class:"text-gray-700"}),a[5]||(a[5]=e("h1",{class:"text-xl font-semibold"},"Error",-1)),s(u)?(l(),d("div",{key:0,class:"text-sm text-red-500",innerHTML:s(u)},null,8,Ze)):i("",!0)])):i("",!0)],64)):(l(),b(se,{key:0,class:"flex-1"}))])}}});export{ns as default};
